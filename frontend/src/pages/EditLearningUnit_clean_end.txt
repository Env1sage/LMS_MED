  const navItems = [
    { id: 'dashboard', icon: <ArrowLeftIcon />, label: 'Back to Dashboard', onClick: () => navigate('/publisher-admin') },
  ];

  const handleLogout = async () => {
    await logout();
    navigate('/login');
  };

  if (loading) {
    return (
      <PageWrapper>
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh' }}>
          <div style={{ textAlign: 'center', color: 'var(--text-secondary)' }}>
            Loading learning unit...
          </div>
        </div>
      </PageWrapper>
    );
  }

  if (!unit) {
    return (
      <PageWrapper>
        <div style={{ display: 'flex', alignItems: 'center', justifyContent: 'center', minHeight: '100vh' }}>
          <div style={{ textAlign: 'center' }}>
            <h2 style={{ color: 'var(--text-primary)' }}>Learning Unit Not Found</h2>
            <button onClick={() => navigate('/publisher-admin')} className="btn-primary" style={{ marginTop: '16px' }}>
              Back to Dashboard
            </button>
          </div>
        </div>
      </PageWrapper>
    );
  }

  return (
    <PageWrapper>
      <GlassSidebar
        title="Publisher Studio"
        subtitle="Edit Learning Unit"
        navItems={navItems}
        userName={user?.fullName}
        userRole="Publisher Admin"
        onLogout={handleLogout}
      />

      <GlassContentArea>
        <GlassContentHeader 
          title="Edit Learning Unit"
          subtitle="Update learning unit details and settings"
          actions={
            <button onClick={() => navigate('/publisher-admin')} className="btn-secondary">
              <ArrowLeftIcon size={16} />
              <span style={{ marginLeft: '8px' }}>Back</span>
            </button>
          }
        />

        {error && (
          <div className="error-banner">
            {error}
            <button onClick={() => setError(null)}>×</button>
          </div>
        )}
        {success && (
          <div className="success-banner">
            Learning unit updated successfully!
            <button onClick={() => setSuccess(false)}>×</button>
          </div>
        )}

        <form onSubmit={handleSubmit}>
          <div className="glass-card" style={{ marginBottom: '24px' }}>
            <div className="glass-card-header">
              <PencilIcon size={24} />
              <div style={{ marginLeft: '12px' }}>
                <h3 className="glass-card-title">Basic Information</h3>
                <p className="glass-card-subtitle">Update the learning unit details</p>
              </div>
            </div>

            <div className="form-grid">
              <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                <label className="form-label">Title *</label>
                <input
                  type="text"
                  className="form-input"
                  value={formData.title}
                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}
                  required
                  placeholder="Enter learning unit title..."
                />
              </div>

              <div className="form-group" style={{ gridColumn: '1 / -1' }}>
                <label className="form-label">Description</label>
                <textarea
                  className="form-input"
                  style={{ minHeight: '100px' }}
                  value={formData.description}
                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}
                  placeholder="Describe the learning objectives..."
                />
              </div>

              <div className="form-group">
                <label className="form-label">Content Type *</label>
                <div className="form-value">{unit.type}</div>
              </div>

              <div className="form-group">
                <label className="form-label">Difficulty Level *</label>
                <select
                  className="form-input"
                  value={formData.difficultyLevel}
                  onChange={(e) => setFormData({ ...formData, difficultyLevel: e.target.value as DifficultyLevel })}
                  required
                >
                  <option value={DifficultyLevel.K}>K - Knows</option>
                  <option value={DifficultyLevel.KH}>KH - Knows How</option>
                  <option value={DifficultyLevel.SH}>SH - Shows How</option>
                  <option value={DifficultyLevel.D}>D - Does</option>
                </select>
              </div>

              <div className="form-group">
                <label className="form-label">Estimated Duration (minutes)</label>
                <input
                  type="number"
                  className="form-input"
                  value={formData.estimatedDuration}
                  onChange={(e) => setFormData({ ...formData, estimatedDuration: parseInt(e.target.value) })}
                  min="1"
                />
              </div>

              <div className="form-group">
                <label className="form-label">Delivery Type *</label>
                <select
                  className="form-input"
                  value={formData.deliveryType}
                  onChange={(e) => setFormData({ ...formData, deliveryType: e.target.value as DeliveryType })}
                  required
                >
                  <option value={DeliveryType.EMBED}>Embed</option>
                  <option value={DeliveryType.LINK}>Link</option>
                  <option value={DeliveryType.DOWNLOAD}>Download</option>
                </select>
              </div>
            </div>
          </div>

          <div className="glass-card" style={{ marginBottom: '24px' }}>
            <div className="glass-card-header">
              <UploadIcon size={24} />
              <div style={{ marginLeft: '12px' }}>
                <h3 className="glass-card-title">Content File</h3>
                <p className="glass-card-subtitle">Update the content file if needed</p>
              </div>
            </div>

            {unit.secureAccessUrl && (
              <div style={{ padding: '16px', background: 'rgba(0, 107, 92, 0.05)', border: '1px solid rgba(0, 107, 92, 0.15)', borderRadius: '8px', marginBottom: '16px' }}>
                <div style={{ fontWeight: 600, marginBottom: '4px' }}>Current File</div>
                <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>{unit.secureAccessUrl.split('/').pop()}</div>
              </div>
            )}

            <div
              onDragEnter={handleDrag}
              onDragLeave={handleDrag}
              onDragOver={handleDrag}
              onDrop={handleDrop}
              style={{
                padding: '40px',
                border: dragActive ? '2px dashed var(--primary-color)' : '2px dashed rgba(255, 255, 255, 0.1)',
                borderRadius: '12px',
                textAlign: 'center',
                background: dragActive ? 'rgba(0, 107, 92, 0.05)' : 'transparent',
                transition: 'all 0.2s ease',
                cursor: 'pointer',
              }}
              onClick={() => fileInputRef.current?.click()}
            >
              <UploadIcon size={48} style={{ marginBottom: '16px', opacity: 0.5 }} />
              <div style={{ marginBottom: '8px', fontWeight: 600 }}>
                {uploading ? 'Uploading...' : 'Drop file here or click to browse'}
              </div>
              <div style={{ fontSize: '13px', color: 'var(--text-secondary)' }}>
                Supported formats: PDF, MP4, YouTube links
              </div>
              <input
                ref={fileInputRef}
                type="file"
                onChange={handleFileChange}
                accept=".pdf,.mp4"
                style={{ display: 'none' }}
              />
            </div>

            {uploadedFile && (
              <div style={{ marginTop: '16px', padding: '12px', background: 'rgba(0, 107, 92, 0.1)', border: '1px solid rgba(0, 107, 92, 0.2)', borderRadius: '8px' }}>
                <div style={{ fontWeight: 600, marginBottom: '4px' }}>New File Uploaded</div>
                <div style={{ fontSize: '14px', color: 'var(--text-secondary)' }}>{uploadedFile.name}</div>
              </div>
            )}
          </div>

          <div className="glass-card" style={{ marginBottom: '24px' }}>
            <div className="glass-card-header">
              <TargetIcon size={24} />
              <div style={{ marginLeft: '12px' }}>
                <h3 className="glass-card-title">Topic & Competencies</h3>
                <p className="glass-card-subtitle">Current topic and competency mappings</p>
              </div>
            </div>

            <div className="form-grid">
              <div className="form-group">
                <label className="form-label">Subject</label>
                <div className="form-value">{unit.subject}</div>
              </div>
              <div className="form-group">
                <label className="form-label">Topic</label>
                <div className="form-value">{unit.topic}</div>
              </div>
            </div>

            {unit.competencies && unit.competencies.length > 0 && (
              <div style={{ marginTop: '16px' }}>
                <label className="form-label">Mapped Competencies</label>
                <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px', marginTop: '8px' }}>
                  {unit.competencies.map((comp: any) => (
                    <span
                      key={comp.id}
                      style={{
                        padding: '6px 12px',
                        background: 'rgba(0, 107, 92, 0.1)',
                        border: '1px solid rgba(0, 107, 92, 0.2)',
                        borderRadius: '6px',
                        fontSize: '13px',
                      }}
                    >
                      {comp.code}
                    </span>
                  ))}
                </div>
              </div>
            )}
          </div>

          <div className="glass-card" style={{ marginBottom: '24px' }}>
            <div className="glass-card-header">
              <CogIcon size={24} />
              <div style={{ marginLeft: '12px' }}>
                <h3 className="glass-card-title">Security Settings</h3>
                <p className="glass-card-subtitle">Configure content protection and access</p>
              </div>
            </div>

            <div className="form-grid">
              <div className="form-group">
                <label className="form-label">
                  <input
                    type="checkbox"
                    checked={formData.watermarkEnabled}
                    onChange={(e) => setFormData({ ...formData, watermarkEnabled: e.target.checked })}
                    style={{ marginRight: '8px' }}
                  />
                  Enable Watermark
                </label>
              </div>

              <div className="form-group">
                <label className="form-label">Session Expiry (minutes)</label>
                <input
                  type="number"
                  className="form-input"
                  value={formData.sessionExpiryMinutes}
                  onChange={(e) => setFormData({ ...formData, sessionExpiryMinutes: parseInt(e.target.value) })}
                  min="1"
                />
              </div>
            </div>
          </div>

          <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px' }}>
            <button
              type="button"
              className="btn-secondary"
              onClick={() => navigate('/publisher-admin')}
            >
              Cancel
            </button>
            <button
              type="submit"
              className="btn-primary"
              disabled={saving}
            >
              {saving ? 'Updating...' : 'Update Learning Unit'}
            </button>
          </div>
        </form>
      </GlassContentArea>
    </PageWrapper>
  );
};

export default EditLearningUnit;
