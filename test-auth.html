<!DOCTYPE html>
<html>
<head>
    <title>Auth Test - Medical LMS</title>
    <style>
        body { font-family: Arial; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 8px; }
        button { background: #4f46e5; color: white; border: none; padding: 12px 24px; border-radius: 6px; cursor: pointer; margin: 5px; }
        button:hover { background: #4338ca; }
        .output { background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 6px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; max-height: 400px; overflow-y: auto; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        h2 { color: #1e293b; border-bottom: 2px solid #4f46e5; padding-bottom: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h2>üîê Medical LMS - Authentication Test</h2>
        
        <div>
            <button onclick="checkToken()">1. Check Token in LocalStorage</button>
            <button onclick="login()">2. Login as Faculty</button>
            <button onclick="testDashboard()">3. Test Analytics Dashboard</button>
            <button onclick="clearStorage()">Clear LocalStorage</button>
        </div>
        
        <div id="output" class="output"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3001/api';
        
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            output.innerHTML += `<div class="${className}">${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function checkToken() {
            const token = localStorage.getItem('accessToken');
            const user = localStorage.getItem('user');
            log('\n=== LOCALSTORAGE CHECK ===');
            if (token) {
                log(`‚úÖ Token found: ${token.substring(0, 50)}...`, 'success');
                log(`Token length: ${token.length}`);
            } else {
                log('‚ùå No token found in localStorage', 'error');
            }
            if (user) {
                log(`‚úÖ User data: ${user}`, 'success');
            } else {
                log('‚ùå No user data found', 'error');
            }
        }
        
        async function login() {
            log('\n=== LOGIN TEST ===');
            log('Logging in as faculty1@aiimsnagpur.edu.in...');
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'faculty1@aiimsnagpur.edu.in',
                        password: 'Password123!'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.accessToken) {
                    localStorage.setItem('accessToken', data.accessToken);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    log(`‚úÖ Login successful!`, 'success');
                    log(`Token: ${data.accessToken.substring(0, 50)}...`);
                    log(`User: ${data.user.name} (${data.user.role})`);
                } else {
                    log(`‚ùå Login failed: ${JSON.stringify(data)}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testDashboard() {
            log('\n=== ANALYTICS DASHBOARD TEST ===');
            const token = localStorage.getItem('accessToken');
            
            if (!token) {
                log('‚ùå No token found! Please login first.', 'error');
                return;
            }
            
            log('Fetching analytics dashboard...');
            
            try {
                const response = await fetch(`${API_URL}/faculty/analytics/dashboard`, {
                    headers: {
                        'Authorization': `Bearer ${token}`,
                        'Content-Type': 'application/json'
                    }
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log(`‚úÖ Dashboard data received!`, 'success');
                    log(JSON.stringify(data, null, 2));
                } else {
                    log(`‚ùå Failed: ${response.status} ${response.statusText}`, 'error');
                    log(JSON.stringify(data, null, 2));
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        function clearStorage() {
            localStorage.clear();
            log('\nüóëÔ∏è  LocalStorage cleared');
        }
        
        // Auto-check on load
        window.onload = () => {
            log('Medical LMS Authentication Test Tool');
            log('Click buttons above to test authentication');
            checkToken();
        };
    </script>
</body>
</html>
